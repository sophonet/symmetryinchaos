<!DOCTYPE html>
<html>

<head>
    <title>Symmetry in Chaos</title>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>

<body style="background-color: #000;">

    <!-- Parameter-->
    <div id="params" style="display: grid; grid-template-columns: 5em 3em auto; color: white;">
        <div>dataset</div><div></div> <select name="dataset" id="dataset"></select>
        <div>lambda</div><output id="lambdavalue" for="lambda"></output> <input style="width: 100%" type="range" id="lambda" name="lambda" min="-20.0" max="20.0" step="0.01">
        <div>alpha</div><output id="alphavalue"></output><input style="width: 100%" type="range" id="alpha" name="alpha" min="-20.0" max="20.0" step="0.01">
        <div>beta</div><output id="betavalue"></output><input style="width: 100%" type="range" id="beta" name="beta" min="-20.0" max="20.0" step="0.01">
        <div>gamma</div><output id="gammavalue"></output><input style="width: 100%" type="range" id="gamma" name="gamma" min="-20.0" max="20.0" step="0.01">
        <div>delta</div><output id="deltavalue"></output><input style="width: 100%" type="range" id="delta" name="delta" min="-20.0" max="20.0" step="0.01">
        <div>omega</div><output id="omegavalue"></output><input style="width: 100%" type="range" id="omega" name="omega" min="-20.0" max="20.0" step="0.01">
        <div>n</div><output id="nvalue"></output><input style="width: 100%" type="range" id="n" name="n" min="3" max="40">
        <div>p</div><output id="pvalue"></output><input style="width: 100%" type="range" id="p" name="p" min="0" max="5">
        <div>extent</div><output id="extentvalue"></output><input style="width: 100%" type="range" id="extent" name="extent" min="0" max="10" step="0.1">
    </div>

    <!-- Create the canvas that the C++ code will draw into -->
    <canvas id="canvas" oncontextmenu="event.preventDefault()"></canvas>

    <!-- Allow the C++ to access the canvas element --> 
    <script type='text/javascript'>
        var Module = {
            canvas: (function() { return document.getElementById('canvas'); })(),
            // Quick hack to wait until SDL surface has been prepared inside main()
            onRuntimeInitialized: (function() { 
                setTimeout(() => {
                    select_dataset();
                },500)})
        };
    </script>
    
    <!-- Add the javascript glue code (index.js) as generated by Emscripten -->
    <script src="index.js"></script>
    <script language="javascript">
        var symmetry_datasets = null;

        dropdown = document.getElementById('dataset')
        dropdown.addEventListener("change", select_dataset, false);
        document.getElementById('lambda').addEventListener("input", change_parameters, false);
        document.getElementById('alpha').addEventListener("input", change_parameters, false);
        document.getElementById('beta').addEventListener("input", change_parameters, false);
        document.getElementById('gamma').addEventListener("input", change_parameters, false);
        document.getElementById('delta').addEventListener("input", change_parameters, false);
        document.getElementById('omega').addEventListener("input", change_parameters, false);
        document.getElementById('n').addEventListener("input", change_parameters, false);
        document.getElementById('p').addEventListener("input", change_parameters, false);
        document.getElementById('extent').addEventListener("input", change_parameters, false);

        function update_labels(params) {
            console.log(params);
            document.getElementById("lambdavalue").value = params.lambda;
            document.getElementById("alphavalue").value = params.alpha;
            document.getElementById("betavalue").value = params.beta;
            document.getElementById("gammavalue").value = params.gamma;
            document.getElementById("deltavalue").value = params.delta;
            document.getElementById("omegavalue").value = params.omega;
            document.getElementById("nvalue").value = params.n;
            document.getElementById("pvalue").value = params.p;
            document.getElementById("extentvalue").value = params.extent;
        }

        function change_parameters() {
            const dataset = symmetry_datasets[dropdown.value];
            const params = {
                lambda: +document.getElementById('lambda').value,
                alpha: +document.getElementById('alpha').value,
                beta: +document.getElementById('beta').value,
                gamma: +document.getElementById('gamma').value,
                delta: +document.getElementById('delta').value,
                omega: +document.getElementById('omega').value,
                n: +document.getElementById('n').value,
                p: +document.getElementById('p').value,
                extent: +document.getElementById('extent').value,
                palette: dataset.palette
            }
            console.log("Hallo");
            console.log(params);
            console.log("Huhu");
            update_labels(params);
            try {
                Module.ccall('launch', null, ['string'],[JSON.stringify(params)]);
            }
            catch(error) {
                console.log("Error: " + error);
            }
        };

        function select_dataset() {
            const dataset = symmetry_datasets[dropdown.value];
            document.getElementById('lambda').value = dataset.lambda;
            document.getElementById('alpha').value = dataset.alpha;
            document.getElementById('beta').value = dataset.beta;
            document.getElementById('gamma').value = dataset.gamma;
            document.getElementById('delta').value = dataset.delta;
            document.getElementById('omega').value = dataset.omega;
            document.getElementById('n').value = dataset.n;
            document.getElementById('p').value = dataset.p;
            document.getElementById('extent').value = dataset.extent;
            update_labels(symmetry_datasets[dropdown.value]);
            Module.ccall('launch', null, ['string'],[JSON.stringify(dataset)]);
        };

        function set_datasets(datasets) {
            symmetry_datasets = datasets;
            dropdown = document.getElementById('dataset')
            for(var dataset in datasets) {
                var opt = document.createElement('option');
                opt.value = dataset;
                opt.innerHTML = dataset;
                dropdown.appendChild(opt);
            }
        }
    
        fetch("datasets.json")
        .then(res => res.json())
        .then(datasets => set_datasets(datasets))
        .catch(error => console.log(error));

    </script>
</body>

</html>